{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport useIsPiecePinned from './Check for pin';\nimport pinFilter from './Pin filter';\nimport useCanCastle from './Allow castling';\nimport { useSelector } from 'react-redux';\nimport useKingCoordinates from '../King activity/Find king';\nimport useCheckForChecks from '../King activity/Checks';\nexport default function useFilterNextMoves() {\n  _s();\n\n  const {\n    gameField,\n    coverMoves,\n    turn\n  } = useSelector(store => store.chess);\n  const isPiecePinned = useIsPiecePinned();\n  const checkForChecks = useCheckForChecks();\n  const canCastle = useCanCastle();\n  const king = useKingCoordinates(turn + 'K');\n  return (x, y, nextMoves) => {\n    let [color, piece] = gameField[y][x];\n    let newMoves = nextMoves.filter(_ref => {\n      let [x, y] = _ref;\n      return x >= 0 && x < 8 && y >= 0 && y < 8 && gameField[y][x][0] !== color;\n    });\n\n    if (piece === 'K') {\n      newMoves = newMoves.filter(move => !checkForChecks(move));\n      newMoves.push(...castlingMoves(x, y));\n    }\n\n    if (piece === 'P') {\n      newMoves = newMoves.filter(_ref2 => {\n        let [a, b] = _ref2;\n        return !(a === x && gameField[b][a] !== '0');\n      });\n    }\n\n    if (coverMoves.length && piece !== 'K') {\n      let saves = coverMoves.map(elm => elm.toString());\n      newMoves = newMoves.filter(move => saves.includes(move.toString()));\n    }\n\n    if (isPiecePinned([x, y])) {\n      console.log(color + piece, 'is Pinned');\n      newMoves = newMoves.filter(move => pinFilter(move, [x, y], king));\n    }\n\n    return newMoves;\n  };\n}\n\n_s(useFilterNextMoves, \"aIZBuMkuxn5I548z+XCVKYcMcuQ=\", false, function () {\n  return [useSelector, useIsPiecePinned, useCheckForChecks, useCanCastle, useKingCoordinates];\n});","map":{"version":3,"names":["useIsPiecePinned","pinFilter","useCanCastle","useSelector","useKingCoordinates","useCheckForChecks","useFilterNextMoves","gameField","coverMoves","turn","store","chess","isPiecePinned","checkForChecks","canCastle","king","x","y","nextMoves","color","piece","newMoves","filter","move","push","castlingMoves","a","b","length","saves","map","elm","toString","includes","console","log"],"sources":["C:/Users/alapc/OneDrive/Documents/Programming/chess/src/Chessboard/Game/Pieces/Logic/Next moves/Filtration.js"],"sourcesContent":["import useIsPiecePinned from './Check for pin'\r\nimport pinFilter from './Pin filter'\r\nimport useCanCastle from './Allow castling'\r\nimport { useSelector } from 'react-redux'\r\nimport useKingCoordinates from '../King activity/Find king'\r\nimport useCheckForChecks from '../King activity/Checks'\r\n\r\nexport default function useFilterNextMoves() {\r\n\tconst { gameField, coverMoves, turn } = useSelector((store) => store.chess)\r\n\r\n\tconst isPiecePinned = useIsPiecePinned()\r\n\tconst checkForChecks = useCheckForChecks()\r\n\tconst canCastle = useCanCastle()\r\n\tconst king = useKingCoordinates(turn + 'K')\r\n\r\n\treturn (x, y, nextMoves) => {\r\n\t\tlet [color, piece] = gameField[y][x]\r\n\t\tlet newMoves = nextMoves.filter(\r\n\t\t\t([x, y]) =>\r\n\t\t\t\tx >= 0 &&\r\n\t\t\t\tx < 8 &&\r\n\t\t\t\ty >= 0 &&\r\n\t\t\t\ty < 8 &&\r\n\t\t\t\tgameField[y][x][0] !== color\r\n\t\t)\r\n\r\n\t\tif (piece === 'K') {\r\n\t\t\tnewMoves = newMoves.filter((move) => !checkForChecks(move))\r\n\t\t\tnewMoves.push(...castlingMoves(x, y))\r\n\t\t}\r\n\r\n\t\tif (piece === 'P') {\r\n\t\t\tnewMoves = newMoves.filter(\r\n\t\t\t\t([a, b]) => !(a === x && gameField[b][a] !== '0')\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\tif (coverMoves.length && piece !== 'K') {\r\n\t\t\tlet saves = coverMoves.map((elm) => elm.toString())\r\n\t\t\tnewMoves = newMoves.filter((move) =>\r\n\t\t\t\tsaves.includes(move.toString())\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\tif (isPiecePinned([x, y])) {\r\n\t\t\tconsole.log(color + piece, 'is Pinned')\r\n\t\t\tnewMoves = newMoves.filter((move) => pinFilter(move, [x, y], king))\r\n\t\t}\r\n\r\n\t\treturn newMoves\r\n\t}\r\n}\r\n"],"mappings":";;AAAA,OAAOA,gBAAP,MAA6B,iBAA7B;AACA,OAAOC,SAAP,MAAsB,cAAtB;AACA,OAAOC,YAAP,MAAyB,kBAAzB;AACA,SAASC,WAAT,QAA4B,aAA5B;AACA,OAAOC,kBAAP,MAA+B,4BAA/B;AACA,OAAOC,iBAAP,MAA8B,yBAA9B;AAEA,eAAe,SAASC,kBAAT,GAA8B;EAAA;;EAC5C,MAAM;IAAEC,SAAF;IAAaC,UAAb;IAAyBC;EAAzB,IAAkCN,WAAW,CAAEO,KAAD,IAAWA,KAAK,CAACC,KAAlB,CAAnD;EAEA,MAAMC,aAAa,GAAGZ,gBAAgB,EAAtC;EACA,MAAMa,cAAc,GAAGR,iBAAiB,EAAxC;EACA,MAAMS,SAAS,GAAGZ,YAAY,EAA9B;EACA,MAAMa,IAAI,GAAGX,kBAAkB,CAACK,IAAI,GAAG,GAAR,CAA/B;EAEA,OAAO,CAACO,CAAD,EAAIC,CAAJ,EAAOC,SAAP,KAAqB;IAC3B,IAAI,CAACC,KAAD,EAAQC,KAAR,IAAiBb,SAAS,CAACU,CAAD,CAAT,CAAaD,CAAb,CAArB;IACA,IAAIK,QAAQ,GAAGH,SAAS,CAACI,MAAV,CACd;MAAA,IAAC,CAACN,CAAD,EAAIC,CAAJ,CAAD;MAAA,OACCD,CAAC,IAAI,CAAL,IACAA,CAAC,GAAG,CADJ,IAEAC,CAAC,IAAI,CAFL,IAGAA,CAAC,GAAG,CAHJ,IAIAV,SAAS,CAACU,CAAD,CAAT,CAAaD,CAAb,EAAgB,CAAhB,MAAuBG,KALxB;IAAA,CADc,CAAf;;IASA,IAAIC,KAAK,KAAK,GAAd,EAAmB;MAClBC,QAAQ,GAAGA,QAAQ,CAACC,MAAT,CAAiBC,IAAD,IAAU,CAACV,cAAc,CAACU,IAAD,CAAzC,CAAX;MACAF,QAAQ,CAACG,IAAT,CAAc,GAAGC,aAAa,CAACT,CAAD,EAAIC,CAAJ,CAA9B;IACA;;IAED,IAAIG,KAAK,KAAK,GAAd,EAAmB;MAClBC,QAAQ,GAAGA,QAAQ,CAACC,MAAT,CACV;QAAA,IAAC,CAACI,CAAD,EAAIC,CAAJ,CAAD;QAAA,OAAY,EAAED,CAAC,KAAKV,CAAN,IAAWT,SAAS,CAACoB,CAAD,CAAT,CAAaD,CAAb,MAAoB,GAAjC,CAAZ;MAAA,CADU,CAAX;IAGA;;IAED,IAAIlB,UAAU,CAACoB,MAAX,IAAqBR,KAAK,KAAK,GAAnC,EAAwC;MACvC,IAAIS,KAAK,GAAGrB,UAAU,CAACsB,GAAX,CAAgBC,GAAD,IAASA,GAAG,CAACC,QAAJ,EAAxB,CAAZ;MACAX,QAAQ,GAAGA,QAAQ,CAACC,MAAT,CAAiBC,IAAD,IAC1BM,KAAK,CAACI,QAAN,CAAeV,IAAI,CAACS,QAAL,EAAf,CADU,CAAX;IAGA;;IAED,IAAIpB,aAAa,CAAC,CAACI,CAAD,EAAIC,CAAJ,CAAD,CAAjB,EAA2B;MAC1BiB,OAAO,CAACC,GAAR,CAAYhB,KAAK,GAAGC,KAApB,EAA2B,WAA3B;MACAC,QAAQ,GAAGA,QAAQ,CAACC,MAAT,CAAiBC,IAAD,IAAUtB,SAAS,CAACsB,IAAD,EAAO,CAACP,CAAD,EAAIC,CAAJ,CAAP,EAAeF,IAAf,CAAnC,CAAX;IACA;;IAED,OAAOM,QAAP;EACA,CAnCD;AAoCA;;GA5CuBf,kB;UACiBH,W,EAElBH,gB,EACCK,iB,EACLH,Y,EACLE,kB"},"metadata":{},"sourceType":"module"}